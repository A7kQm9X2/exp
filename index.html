<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kitchen Drink Quest</title>
  <style>
    :root{
      --bg: #0b0f14;
      --ink: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.68);
      --hud: rgba(255,255,255,0.08);
      --hud-border: rgba(255,255,255,0.14);
      --accent: rgba(130,210,255,0.9);
      --good: rgba(140,255,190,0.85);
      --shadow: rgba(0,0,0,0.45);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 700px at 50% 20%, #142033 0%, var(--bg) 62%, #070a0e 100%);
      color: var(--ink);
      overflow: hidden;
    }

    /* Calm fade in */
    .app{
      position: relative;
      width: 100%;
      height: 100%;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 900ms ease, transform 900ms ease;
    }
    .app.ready{
      opacity: 1;
      transform: translateY(0);
    }

    /* HUD */
    .hud{
      position: absolute;
      top: 18px;
      left: 18px;
      display:flex;
      align-items:center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: 14px;
      background: var(--hud);
      border: 1px solid var(--hud-border);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px var(--shadow);
      z-index: 10;
      user-select: none;
    }
    .hud .count{
      font-size: 14px;
      letter-spacing: 0.04em;
      color: var(--muted);
      display:flex;
      align-items:baseline;
      gap:8px;
      white-space: nowrap;
    }
    .hud .count strong{
      color: var(--ink);
      font-weight: 650;
      font-size: 15px;
    }

    .hud .mini{
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      display:grid;
      place-items:center;
      overflow:hidden;
    }

    .toast{
      position: absolute;
      left: 18px;
      bottom: 18px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,0.82);
      font-size: 13px;
      line-height: 1.25;
      max-width: min(460px, calc(100vw - 36px));
      box-shadow: 0 10px 30px var(--shadow);
      z-index: 10;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 250ms ease, transform 250ms ease;
      pointer-events: none;
    }
    .toast.show{
      opacity: 1;
      transform: translateY(0);
    }
    .toast b{ color: var(--ink); font-weight: 650; }

    /* Scene wrapper */
    .scene-wrap{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      padding: 72px 18px 18px;
    }

    /* Make SVG responsive & crisp */
    svg#kitchen{
      width: min(1100px, 96vw);
      height: auto;
      max-height: 88vh;
      border-radius: 18px;
      box-shadow: 0 24px 80px rgba(0,0,0,0.55);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.10);
      overflow: hidden;
    }

    /* Click affordance */
    .clickable{
      cursor: pointer;
      transition: filter 180ms ease, transform 180ms ease, opacity 180ms ease;
      transform-origin: center;
    }
    .clickable:hover{
      filter: drop-shadow(0 10px 18px rgba(0,0,0,0.35));
      transform: translateY(-1px);
    }
    .clickable.found{
      cursor: default;
      opacity: 0.35;
      filter: saturate(0.6);
      transform: none;
    }

    /* Subtle ambient motion */
    @keyframes floaty {
      0% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
      100% { transform: translateY(0); }
    }
    .ambient{
      animation: floaty 6s ease-in-out infinite;
    }
    @keyframes fridgeGlow {
      0%, 100% { opacity: 0.14; }
      50% { opacity: 0.20; }
    }
    .fridge-glow{
      animation: fridgeGlow 5.5s ease-in-out infinite;
    }

    /* Mini drink icon parts */
    .mini svg{
      width: 36px;
      height: 36px;
    }
    .mini .part{
      opacity: 0;
      transform: translateY(2px);
      transition: opacity 260ms ease, transform 260ms ease;
    }
    .mini .part.on{
      opacity: 1;
      transform: translateY(0);
    }

    /* A11y focus */
    .clickable:focus{
      outline: none;
    }
    .focus-ring:focus-visible{
      filter: drop-shadow(0 0 0 rgba(0,0,0,0));
    }
    /* We'll apply focus ring via stroke highlight in SVG by toggling class */
  </style>
</head>
<body>
  <div class="app" id="app">
    <div class="hud" aria-live="polite">
      <div class="count">
        <strong id="progressText">0 / 4</strong>
        <span id="statusText">make a drink</span>
      </div>

      <!-- Mini drink icon -->
      <div class="mini" title="Drink progress">
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <!-- glass outline always visible -->
          <path d="M22 10h20l-3 44H25L22 10Z" fill="rgba(255,255,255,0.10)" stroke="rgba(255,255,255,0.55)" stroke-width="2" />
          <path d="M24 18h16" stroke="rgba(255,255,255,0.35)" stroke-width="2" />

          <!-- cup found: subtle base highlight -->
          <path id="miniCup" class="part" d="M26 50h12" stroke="rgba(140,255,190,0.85)" stroke-width="3" stroke-linecap="round"/>

          <!-- ice -->
          <g id="miniIce" class="part">
            <rect x="26" y="24" width="8" height="8" rx="2" fill="rgba(190,230,255,0.85)" />
            <rect x="34" y="28" width="8" height="8" rx="2" fill="rgba(190,230,255,0.70)" />
          </g>

          <!-- tequila liquid -->
          <path id="miniTequila" class="part" d="M25 46h14l-1 6H26l-1-6Z" fill="rgba(255, 210, 120, 0.80)"/>

          <!-- soda + bubbles -->
          <g id="miniSoda" class="part">
            <path d="M26 28h12l-2 18H28l-2-18Z" fill="rgba(140, 220, 255, 0.22)"/>
            <circle cx="30" cy="30" r="2.2" fill="rgba(180,240,255,0.85)"/>
            <circle cx="36" cy="34" r="1.8" fill="rgba(180,240,255,0.75)"/>
            <circle cx="33" cy="38" r="1.5" fill="rgba(180,240,255,0.70)"/>
          </g>
        </svg>
      </div>
    </div>

    <div class="toast" id="toast"></div>

    <div class="scene-wrap">
      <!-- Face-on kitchen scene (simple but extendable).
           Replace shapes with your own SVG later; keep IDs & groups. -->
      <svg id="kitchen" viewBox="0 0 1200 720" role="img" aria-label="Interactive kitchen scene">
        <defs>
          <linearGradient id="wall" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0" stop-color="rgba(255,255,255,0.10)"/>
            <stop offset="1" stop-color="rgba(255,255,255,0.02)"/>
          </linearGradient>
          <linearGradient id="counter" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0" stop-color="rgba(255,255,255,0.08)"/>
            <stop offset="1" stop-color="rgba(0,0,0,0.12)"/>
          </linearGradient>
          <linearGradient id="wood" x1="0" x2="1">
            <stop offset="0" stop-color="rgba(255,210,160,0.18)"/>
            <stop offset="1" stop-color="rgba(255,210,160,0.08)"/>
          </linearGradient>
          <filter id="softShadow" x="-30%" y="-30%" width="160%" height="160%">
            <feDropShadow dx="0" dy="10" stdDeviation="10" flood-color="rgba(0,0,0,0.35)" />
          </filter>
        </defs>

        <!-- Background wall -->
        <rect x="0" y="0" width="1200" height="720" fill="url(#wall)"/>

        <!-- Upper cabinets -->
        <g id="cabinets" filter="url(#softShadow)">
          <rect x="90" y="70" width="420" height="170" rx="18" fill="rgba(255,255,255,0.06)" stroke="rgba(255,255,255,0.10)" />
          <rect x="540" y="70" width="570" height="170" rx="18" fill="rgba(255,255,255,0.06)" stroke="rgba(255,255,255,0.10)" />
          <line x1="300" y1="70" x2="300" y2="240" stroke="rgba(255,255,255,0.10)" />
          <line x1="750" y1="70" x2="750" y2="240" stroke="rgba(255,255,255,0.10)" />
          <line x1="930" y1="70" x2="930" y2="240" stroke="rgba(255,255,255,0.10)" />
        </g>

        <!-- Upper-right cabinet clickable area for tequila -->
        <g id="tequilaCabinet" class="clickable ambient" tabindex="0" role="button" aria-label="Open upper-right cabinet">
          <!-- target door region (upper-right) -->
          <rect x="930" y="70" width="180" height="170" rx="18" fill="rgba(130,210,255,0.08)" stroke="rgba(130,210,255,0.20)"/>
          <circle cx="1075" cy="155" r="6" fill="rgba(255,255,255,0.30)"/>
          <text x="1018" y="165" font-size="12" fill="rgba(255,255,255,0.35)">cabinet</text>
        </g>

        <!-- Shelves on left -->
        <g id="shelves" filter="url(#softShadow)">
          <rect x="90" y="270" width="420" height="160" rx="18" fill="rgba(255,255,255,0.04)" stroke="rgba(255,255,255,0.10)" />
          <line x1="110" y1="322" x2="490" y2="322" stroke="rgba(255,255,255,0.10)" />
          <line x1="110" y1="374" x2="490" y2="374" stroke="rgba(255,255,255,0.10)" />
        </g>

        <!-- Cup clickable (on shelves) -->
        <g id="cup" class="clickable ambient" tabindex="0" role="button" aria-label="Pick up cup">
          <!-- A simple cup silhouette sitting on shelf -->
          <path d="M235 340h60l-8 70h-44l-8-70Z" fill="rgba(255,255,255,0.14)" stroke="rgba(255,255,255,0.30)" />
          <path d="M247 355h36" stroke="rgba(255,255,255,0.25)" />
          <text x="245" y="332" font-size="12" fill="rgba(255,255,255,0.35)">cup</text>
        </g>

        <!-- Counter -->
        <g id="countertop" filter="url(#softShadow)">
          <rect x="90" y="470" width="1020" height="150" rx="22" fill="url(#counter)" stroke="rgba(255,255,255,0.10)" />
          <rect x="90" y="470" width="1020" height="42" rx="22" fill="rgba(255,255,255,0.05)"/>
        </g>

        <!-- Fridge on right -->
        <g id="fridge" filter="url(#softShadow)">
          <rect x="820" y="270" width="290" height="350" rx="22" fill="rgba(255,255,255,0.06)" stroke="rgba(255,255,255,0.12)" />
          <line x1="820" y1="410" x2="1110" y2="410" stroke="rgba(255,255,255,0.10)" />
          <!-- glow layer -->
          <rect class="fridge-glow" x="832" y="282" width="266" height="326" rx="18" fill="rgba(130,210,255,0.10)"/>
          <circle cx="1090" cy="350" r="6" fill="rgba(255,255,255,0.28)"/>
          <circle cx="1090" cy="500" r="6" fill="rgba(255,255,255,0.28)"/>
          <text x="840" y="295" font-size="12" fill="rgba(255,255,255,0.35)">fridge</text>
        </g>

        <!-- Ice clickable (in fridge) -->
        <g id="ice" class="clickable" tabindex="0" role="button" aria-label="Grab ice from fridge">
          <rect x="860" y="450" width="110" height="80" rx="14" fill="rgba(190,230,255,0.14)" stroke="rgba(190,230,255,0.26)"/>
          <rect x="874" y="466" width="34" height="28" rx="6" fill="rgba(190,230,255,0.55)"/>
          <rect x="915" y="480" width="34" height="28" rx="6" fill="rgba(190,230,255,0.42)"/>
          <text x="865" y="445" font-size="12" fill="rgba(255,255,255,0.35)">ice</text>
        </g>

        <!-- Soda water clickable (in fridge) -->
        <g id="soda" class="clickable" tabindex="0" role="button" aria-label="Grab soda water from fridge">
          <rect x="1000" y="455" width="70" height="120" rx="18" fill="rgba(140,220,255,0.10)" stroke="rgba(140,220,255,0.22)"/>
          <rect x="1018" y="440" width="34" height="18" rx="8" fill="rgba(255,255,255,0.16)" />
          <text x="1004" y="445" font-size="12" fill="rgba(255,255,255,0.35)">soda</text>
        </g>

        <!-- Optional: a little window / plant for ambient -->
        <g id="window" class="ambient" opacity="0.9">
          <rect x="540" y="285" width="240" height="130" rx="18" fill="rgba(130,210,255,0.10)" stroke="rgba(255,255,255,0.10)" />
          <line x1="660" y1="285" x2="660" y2="415" stroke="rgba(255,255,255,0.10)" />
          <line x1="540" y1="350" x2="780" y2="350" stroke="rgba(255,255,255,0.10)" />
        </g>
      </svg>
    </div>
  </div>

  <script>
    (() => {
      "use strict";

      // === Config ===
      const STORAGE_KEY = "kitchen_drink_progress_v1";
      const TOTAL = 4;

      // Item mapping (must match your spec)
      const ITEMS = [
        { id: "cup",  label: "Cup",       step: 1, hint: "Found the cup." },
        { id: "ice",  label: "Ice",       step: 2, hint: "Ice! Nice." },
        { id: "tequilaCabinet", label: "Tequila", step: 3, hint: "Tequila secured." },
        { id: "soda", label: "Soda water", step: 4, hint: "Soda water topped it up." }
      ];

      // Mini icon parts (sequence)
      const MINI_PARTS = {
        1: ["miniCup"],
        2: ["miniCup", "miniIce"],
        3: ["miniCup", "miniIce", "miniTequila"],
        4: ["miniCup", "miniIce", "miniTequila", "miniSoda"]
      };

      // === State ===
      const state = {
        found: new Set(), // ids
      };

      // === Elements ===
      const app = document.getElementById("app");
      const progressText = document.getElementById("progressText");
      const statusText = document.getElementById("statusText");
      const toast = document.getElementById("toast");

      // Mini parts
      const miniCup = document.getElementById("miniCup");
      const miniIce = document.getElementById("miniIce");
      const miniTequila = document.getElementById("miniTequila");
      const miniSoda = document.getElementById("miniSoda");
      const miniPartsEls = { miniCup, miniIce, miniTequila, miniSoda };

      // === Helpers ===
      function safeParse(json) {
        try { return JSON.parse(json); } catch { return null; }
      }

      function loadProgress() {
        const raw = localStorage.getItem(STORAGE_KEY);
        const parsed = raw ? safeParse(raw) : null;
        if (!parsed || !Array.isArray(parsed.found)) return;

        parsed.found.forEach(id => state.found.add(id));
      }

      function saveProgress() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({
          found: Array.from(state.found),
          savedAt: Date.now()
        }));
      }

      function showToast(html, ms = 1400) {
        toast.innerHTML = html;
        toast.classList.add("show");
        window.clearTimeout(showToast._t);
        showToast._t = window.setTimeout(() => toast.classList.remove("show"), ms);
      }

      function foundCount() {
        // Ensure we count in mapping order
        return ITEMS.reduce((acc, item) => acc + (state.found.has(item.id) ? 1 : 0), 0);
      }

      function updateHUD() {
        const count = foundCount();
        progressText.textContent = `${count} / ${TOTAL}`;
        if (count < TOTAL) {
          statusText.textContent = "make a drink";
        } else {
          statusText.textContent = "cheers ✨";
        }

        // Mini icon
        // Clear all
        Object.values(miniPartsEls).forEach(el => el.classList.remove("on"));
        const partsToShow = MINI_PARTS[Math.min(count, TOTAL)] || [];
        partsToShow.forEach(id => miniPartsEls[id]?.classList.add("on"));
      }

      function markFound(id) {
        if (state.found.has(id)) return false;
        state.found.add(id);
        saveProgress();
        return true;
      }

      function setClickableFoundVisuals() {
        // Add .found class to scene elements already collected
        ITEMS.forEach(item => {
          const el = document.getElementById(item.id);
          if (!el) return;
          if (state.found.has(item.id)) {
            el.classList.add("found");
            el.setAttribute("aria-disabled", "true");
          }
        });
      }

      function wireInteractions() {
        // Attach click + keyboard activation (Enter/Space)
        ITEMS.forEach(item => {
          const el = document.getElementById(item.id);
          if (!el) return;

          const activate = () => {
            if (state.found.has(item.id)) {
              showToast(`You already grabbed <b>${item.label}</b>.`, 900);
              return;
            }

            const changed = markFound(item.id);
            if (changed) {
              el.classList.add("found");
              el.setAttribute("aria-disabled", "true");
              updateHUD();

              // Slightly “reward” with a toast
              const count = foundCount();
              const remaining = TOTAL - count;
              const tail = remaining > 0
                ? ` <span style="opacity:.75">(${remaining} to go)</span>`
                : ` <span style="color:rgba(140,255,190,.9)">done</span>`;

              showToast(`<b>${item.label}</b> found.${tail}`, 1400);

              if (count === TOTAL) {
                // extra completion toast
                window.setTimeout(() => {
                  showToast(`Drink complete. <b>Cheers.</b>`, 1600);
                }, 500);
              }
            }
          };

          el.addEventListener("click", activate);

          el.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              activate();
            }
          });
        });

        // Optional: reset with a key chord (local dev convenience)
        // Ctrl/Cmd + Shift + R
        window.addEventListener("keydown", (e) => {
          const isMac = navigator.platform.toLowerCase().includes("mac");
          const metaOrCtrl = isMac ? e.metaKey : e.ctrlKey;
          if (metaOrCtrl && e.shiftKey && e.key.toLowerCase() === "r") {
            e.preventDefault();
            localStorage.removeItem(STORAGE_KEY);
            state.found.clear();
            // remove found visuals
            ITEMS.forEach(item => {
              const el = document.getElementById(item.id);
              if (!el) return;
              el.classList.remove("found");
              el.removeAttribute("aria-disabled");
            });
            updateHUD();
            showToast(`Progress reset.`, 1200);
          }
        });
      }

      function init() {
        loadProgress();
        setClickableFoundVisuals();
        updateHUD();
        wireInteractions();

        // Calm fade-in after first paint
        requestAnimationFrame(() => {
          requestAnimationFrame(() => app.classList.add("ready"));
        });

        // Tiny onboarding toast if empty
        if (foundCount() === 0) {
          window.setTimeout(() => {
            showToast(`Find ingredients to <b>make a drink</b>.`, 1500);
          }, 700);
        }
      }

      init();
    })();
  </script>
</body>
</html>
